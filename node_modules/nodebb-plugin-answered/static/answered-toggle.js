$(document).ready(function() {
  $('#answeredToggleBtn').on('click', function() {
    const $btn = $(this);
    // Determine the desired new status based on the button text:
    // If it says "Mark as Unanswered", then the topic is currently answered
    const markAnswered = $btn.text().trim().toLowerCase().includes('answered');
    const tid = ajaxify.data.tid;  // NodeBB exposes the current topic ID via ajaxify.data

    // Disable button to prevent multiple clicks
    $btn.prop('disabled', true);

    $.ajax({
      url: `${config.relative_path}/api/topic/${tid}/answer-status`,
      type: 'PUT',
      data: { answered: markAnswered },
      success: function(response) {
        // On success, update the UI
        if (markAnswered) {
          $('.answered-label').removeClass('text-danger').addClass('text-success').text('Answered');
          $btn.text('Mark Unanswered');
        } else {
          $('.answered-label').removeClass('text-success').addClass('text-danger').text('Unanswered');
          $btn.text('Mark Answered');
        }
      },
      error: function(xhr) {
        console.error('Error toggling answer status:', xhr.responseText);
        alert('Could not update status. Please try again.');
      },
      complete: function() {
        $btn.prop('disabled', false);
      }
    });
  });
});
